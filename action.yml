name: output-codeql-db
description: Output the path of the CodeQL database
inputs:
  language:
    required: true
outputs:
  database-path:
    value: ${{ steps.generate-codeql-database.outputs.database-path }}
runs:
  using: composite
  steps: 
    - id: generate-codeql-database
      shell: bash
      env:
        CODEQL_DB_DIR: ${{ runner.temp }}/codeql_databases/${{ inputs.language }}
      run: |
        set -o errexit
        set -o noglob
        set -o nounset
        zip \
          -9 \
          --verbose \
          --recurse \
          --exclude "$CODEQL_DB_DIR/log" \
          --exclude "$CODEQL_DB_DIR/results" \
          --exclude "$CODEQL_DB_DIR/working" \
          db.zip "$CODEQL_DB_DIR"
        echo "::set-output name=database-path::${PWD}/db.zip"
